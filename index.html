<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <script>
    // Apply theme instantly before render to prevent flash
    const initialTheme = localStorage.getItem('theme');
    if (initialTheme === 'dark') document.documentElement.classList.add('dark-mode');
    if (initialTheme === 'black') document.documentElement.classList.add('black-mode');
  </script>
  <meta name="viewport" content="width=device-width" />
  <meta name="description" content="A minimal, keyboard-centric start page with dynamic themes and AI routing." />
  <meta property="og:title" content="Start Page" />
  <meta property="og:description" content="A minimal, keyboard-centric start page." />
  <meta name="theme-color" content="#ffffff" id="meta-theme-color" />
  <link rel="icon" type="image/png" href="icon/favicon.png">
  <title>Start Page</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

</head>

<body>
  <noscript>
    <div
      style="position: fixed; top: 0; left: 0; width: 100%; padding: 20px; background: #e74c3c; color: white; text-align: center; z-index: 9999;">
      This start page requires JavaScript to function. Please enable JavaScript in your browser settings.
    </div>
  </noscript>
  <div id="theme-overlay-scanlines" class="theme-overlay"></div>
  <div id="theme-overlay-texture" class="theme-overlay"></div>

  <div class="content">
    <!-- Time and Weather Info -->
    <div class="info-section">
      <div class="time" id="time-display">--:--</div>
      <div class="separator">|</div>
      <div class="weather" id="weather-display">
        <span>--°</span>
      </div>
    </div>

    <!-- Bookmarks Section -->
    <section class="bookmark-sections" id="bookmarks">
      <!-- Bookmarks will be generated by JavaScript -->
    </section>

    <!-- Terminal Command Line -->
    <section class="terminal-section">
      <p><span id="username">user</span>@<span id="browser-info">browser</span><span>$</span></p>
      <div class="terminal-input-wrapper">
        <div class="command-hint" id="command-hint"></div>
        <input id="terminal-input" type="text" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off" aria-label="Terminal Input" />
      </div>
      <div class="ai-route-badge" id="ai-route-badge" aria-live="polite"></div>
    </section>
  </div>

  <!-- Config Modal -->
  <div class="config-modal" id="config-modal" lang="en" role="dialog" aria-labelledby="config-modal-title">
    <div class="config-content">
      <h2 id="config-modal-title">Configuration</h2>

      <div class="config-section">
        <h3>Username</h3>
        <input type="text" id="config-username" spellcheck="false" autocorrect="off" />
      </div>

      <div class="config-section">
        <button class="btn-save btn-edit-bookmarks" onclick="openBookmarksModal()">Edit Bookmarks</button>
      </div>

      <div class="config-section">
        <h3>Weather Location</h3>
        <input type="text" id="weather-location" spellcheck="false" autocorrect="off" />
      </div>

      <div class="config-section">
        <h3>Weather Unit</h3>
        <select id="weather-unit">
          <option value="celsius">Celsius (°C)</option>
          <option value="fahrenheit">Fahrenheit (°F)</option>
        </select>
      </div>

      <div class="config-section">
        <h3>Time Zone</h3>
        <input type="text" id="time-zone" spellcheck="false" autocorrect="off" />
      </div>

      <div class="config-section">
        <h3>Gemini API Key</h3>
        <input type="password" id="gemini-api-key" autocomplete="off" spellcheck="false" />
      </div>

      <div class="config-section">
        <h3>Gemini Model</h3>
        <input type="text" id="gemini-model" spellcheck="false" autocorrect="off" />
      </div>

      <div class="config-section">
        <h3>Gemini System Prompt</h3>
        <textarea id="gemini-system-prompt" spellcheck="false"></textarea>
      </div>

      <div class="config-section">
        <h3>AI Router Mode</h3>
        <label class="config-inline-toggle">
          <input type="checkbox" id="ai-mode-enabled" />
          Enable AI mode (no need to type <span class="config-code">ai:</span>)
        </label>
      </div>

      <div class="config-section">
        <h3>AI Route Badge</h3>
        <select id="ai-route-badge-mode">
          <option value="live">Live preview + routed</option>
          <option value="route">Routed only (previous behavior)</option>
          <option value="off">Disabled</option>
        </select>
      </div>

      <div class="config-section">
        <h3>Default Search Engine</h3>
        <select id="search-engine">
          <option value="google">Google</option>
          <option value="ddg">DuckDuckGo</option>
          <option value="bing">Bing</option>
        </select>
        <p class="config-hint">Used when no prefix is typed (e.g. plain text or <span class="config-code">ai:</span> fallback).</p>
      </div>

      <div class="config-buttons">
        <button class="btn-customize-link" onclick="closeConfig(); openCustomizeModal()">Customize?</button>
        <button class="btn-cancel" onclick="closeConfig()">Cancel</button>
        <button class="btn-save" onclick="saveConfig()">Save</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="config-modal" id="help-modal" lang="en" role="dialog" aria-labelledby="help-modal-title">
    <div class="config-content help-content">
      <h2 id="help-modal-title">Available Commands</h2>

      <div class="help-section">
        <h3>System</h3>
        <div class="help-commands">
          <div class="help-cmd"><span>:config</span> → Open settings (weather, timezone, Gemini, AI mode)</div>
          <div class="help-cmd"><span>:customize</span> → Customize syntax colors &amp; switch theme</div>
          <div class="help-cmd"><span>:bookmarks</span> → Edit bookmarks (grid or JSON)</div>
          <div class="help-cmd"><span>:ipconfig</span> → Show network info &amp; VPN status</div>
          <div class="help-cmd"><span>:netspeed</span> → Run internet speed test</div>
          <div class="help-cmd"><span>:aimode</span> → Toggle AI mode (no <span>ai:</span> prefix needed)</div>
          <div class="help-cmd"><span>:version</span> → Show app version</div>
          <div class="help-cmd"><span>:help</span> → Show this help</div>
        </div>
      </div>

      <div class="help-section">
        <h3>Themes</h3>
        <div class="help-commands">
          <div class="help-cmd"><span>:light</span> → Light mode</div>
          <div class="help-cmd"><span>:dark</span> → Dark mode</div>
          <div class="help-cmd"><span>:black</span> / <span>:amoled</span> → Full black / AMOLED</div>
          <div class="help-cmd"><span>:nord</span> → Arctic Nord</div>
          <div class="help-cmd"><span>:newspaper</span> → Classic Newspaper</div>
          <div class="help-cmd"><span>:coffee</span> → Organic Coffee</div>
          <div class="help-cmd"><span>:root</span> / <span>:hacker</span> → Hacker terminal</div>
          <div class="help-cmd"><span>:neon</span> / <span>:cyberpunk</span> → Cyberpunk Neon</div>
        </div>
      </div>

      <div class="help-section">
        <h3>Search</h3>
        <div class="help-commands">
          <div class="help-cmd"><span>r:query</span> → Search Reddit</div>
          <div class="help-cmd"><span>yt:query</span> → Search YouTube</div>
          <div class="help-cmd"><span>ggl:query</span> → Search Google explicitly</div>
          <div class="help-cmd"><span>bing:query</span> → Search Bing</div>
          <div class="help-cmd"><span>ddg:query</span> → Search DuckDuckGo</div>
          <div class="help-cmd"><span>amazon:query</span> → Search Amazon</div>
          <div class="help-cmd"><span>maps:location</span> → Google Maps</div>
          <div class="help-cmd"><span>imdb:movie</span> → Search IMDb</div>
          <div class="help-cmd"><span>alt:query</span> → Search AlternativeTo</div>
          <div class="help-cmd"><span>def:word</span> → Define word (OneLook)</div>
          <div class="help-cmd"><span>the:phrase</span> → Thesaurus (OneLook)</div>
          <div class="help-cmd"><span>syn:words</span> → Synonyms (OneLook)</div>
          <div class="help-cmd"><span>quote:phrase</span> → Find quotes (OneLook)</div>
          <div class="help-cmd"><span>spell:word</span> → Check spelling</div>
          <div class="help-cmd"><span>cws:name</span> → Search browser extensions</div>
        </div>
      </div>

      <div class="help-section">
        <h3>AI</h3>
        <div class="help-commands">
          <div class="help-cmd"><span>gem:prompt</span> → Ask Gemini directly</div>
          <div class="help-cmd"><span>gemini:prompt</span> → Ask Gemini (alias)</div>
          <div class="help-cmd"><span>ai:intent</span> → Route to best site/tool for your intent</div>
          <div class="help-cmd"><span>:help_ai_router</span> → Guide for how <span>ai:</span> routing works</div>
        </div>
      </div>

      <div class="help-section">
        <h3>General</h3>
        <div class="help-commands">
          <div class="help-cmd">Type <span>website.com</span> → navigate directly (highlighted teal)</div>
          <div class="help-cmd">Type anything else → search with your default engine</div>
          <div class="help-cmd">Trailing space on any command or bookmark → falls through to search</div>
          <div class="help-cmd"><span>Tab</span> / <span>→</span> → accept autocomplete suggestion</div>
          <div class="help-cmd"><span>↑ ↓</span> → navigate command history</div>
          <div class="help-cmd"><span>Ctrl+Enter</span> / <span>Alt+Enter</span> → open bookmark in background tab</div>
          <div class="help-cmd"><span>Ctrl+Shift+Enter</span> / <span>Alt+Shift+Enter</span> → open bookmark in focused tab</div>
        </div>
      </div>

      <div class="config-buttons">
        <button class="btn-save" onclick="closeHelp()">Got it</button>
      </div>
    </div>
  </div>

  <!-- IP Info Modal -->
  <div class="config-modal" id="ip-modal" lang="en" role="dialog" aria-labelledby="ip-modal-title">
    <div class="config-content ip-content">
      <h2 id="ip-modal-title">Network Information</h2>

      <div class="ip-grid">
        <div class="ip-item">
          <div class="ip-label">IPv4 Address</div>
          <div class="ip-value" id="ip-address">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">IPv6 Address</div>
          <div class="ip-value" id="ip-ipv6">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">ISP</div>
          <div class="ip-value" id="ip-isp">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">Location</div>
          <div class="ip-value" id="ip-location">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">Timezone</div>
          <div class="ip-value" id="ip-timezone">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">ASN</div>
          <div class="ip-value" id="ip-asn">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">BGP Network</div>
          <div class="ip-value" id="ip-network">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">DNS</div>
          <div class="ip-value" id="ip-dns">Loading...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">Latency</div>
          <div class="ip-value" id="ip-latency">Testing...</div>
        </div>

        <div class="ip-item">
          <div class="ip-label">VPN Status</div>
          <div class="ip-value" id="ip-vpn">Checking...</div>
        </div>
      </div>

      <div class="config-buttons">
        <button class="btn-save" onclick="closeIPInfo()">Close</button>
      </div>
    </div>
  </div>

  <!-- Network Speed Test Modal -->
  <div class="config-modal" id="speed-modal" lang="en" role="dialog" aria-labelledby="speed-modal-title">
    <div class="config-content speed-content">
      <h2 id="speed-modal-title">Network Speed Test</h2>

      <div class="speed-main">
        <div class="speed-display">
          <div class="speed-value" id="speed-download">--</div>
          <div class="speed-label">Mbps Download</div>
        </div>
        <div class="speed-display">
          <div class="speed-value" id="speed-upload">--</div>
          <div class="speed-label">Mbps Upload</div>
        </div>
        <div class="speed-display">
          <div class="speed-value" id="speed-ping">--</div>
          <div class="speed-label">ms Ping</div>
        </div>
      </div>

      <div class="speed-progress">
        <div class="speed-progress-bar" id="speed-progress-bar"></div>
      </div>

      <div class="speed-signal-display">Signal Strength: <span id="speed-signal">--</span></div>

      <div class="speed-timer" id="speed-timer">00:00</div>

      <div class="speed-status" id="speed-status">Starting test...</div>

      <div class="config-buttons">
        <button class="btn-cancel" onclick="closeSpeedTest()">Close</button>
      </div>
    </div>
  </div>

  <!-- Spell Check Modal -->
  <div class="config-modal" id="spell-modal" lang="en" role="dialog" aria-labelledby="spell-modal-title">
    <div class="config-content spell-check-content">
      <h2 id="spell-modal-title">Spell Check</h2>
      <div class="spell-query-display">spell: <span id="spell-query-word"></span></div>
      <div id="spell-result-area" class="spell-result-area">checking...</div>
      <div class="spell-hint" id="spell-hint"></div>
      <div class="config-buttons">
        <button class="btn-save" onclick="closeSpellModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Bookmarks Modal -->
  <div class="config-modal" id="bookmarks-modal" lang="en" role="dialog" aria-labelledby="bookmarks-modal-title">
    <div class="config-content" style="max-width: 900px;">
      <div class="config-header-row">
        <h2 id="bookmarks-modal-title">Manage Bookmarks</h2>
        <button class="btn-toggle-editor" id="toggle-editor-btn" onclick="toggleEditorMode()">Edit as JSON</button>
      </div>

      <!-- Visual Grid Editor -->
      <div id="bookmarks-grid-editor" class="bookmarks-grid-editor">
        <!-- Dynamically generated -->
      </div>

      <!-- JSON Editor (Hidden by default) -->
      <textarea id="config-textarea" class="hidden" spellcheck="false" style="min-height: 400px;" placeholder='[
  { "href": "https://github.com", "title": "Github" },
  { "href": "https://youtube.com", "title": "YouTube" }
]'></textarea>

      <div class="config-buttons">
        <button class="btn-cancel" onclick="closeBookmarksModal()">Cancel</button>
        <button class="btn-save" onclick="saveBookmarksFromModal()">Save Bookmarks</button>
      </div>
    </div>
  </div>

  <!-- Gemini Modal -->
  <div class="config-modal" id="gemini-modal" lang="en" role="dialog" aria-labelledby="gemini-modal-title">
    <div class="config-content gemini-content">
      <h2 id="gemini-modal-title">Gemini Response</h2>
      <div class="gemini-meta-row">
        <div class="spell-query-display">prompt: <span id="gemini-query-text"></span></div>
        <div class="gemini-model-badge" id="gemini-model-badge">model</div>
      </div>
      <div class="gemini-system-state" id="gemini-system-state">system prompt: off</div>
      <div class="gemini-status" id="gemini-status">waiting...</div>
      <div id="gemini-response-area" class="gemini-response-area">waiting...</div>
      <div class="config-buttons">
        <button class="btn-cancel" onclick="copyGeminiResponse()">Copy</button>
        <button class="btn-save" onclick="closeGeminiModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Customize Modal -->
  <div class="config-modal" id="customize-modal" lang="en" role="dialog" aria-labelledby="customize-modal-title">
    <div class="config-content">
      <h2 id="customize-modal-title">Customize</h2>

      <div class="config-section">
        <div class="customize-section-title">Theme</div>
        <div class="customize-theme-grid" id="customize-theme-grid"></div>
      </div>

      <div class="config-section">
        <div class="customize-section-title">Syntax Highlight Colors</div>
        <p class="config-hint" style="margin-bottom:10px;">These colors are universal — they apply across all themes and persist independently.</p>
        <div class="customize-grid" id="customize-color-grid"></div>
      </div>

      <div class="config-buttons">
        <button class="btn-cancel" onclick="resetAllSyntaxColors()" style="margin-right:auto;">Reset colors</button>
        <button class="btn-cancel" onclick="closeCustomizeModal()">Cancel</button>
        <button class="btn-save" onclick="saveCustomize()">Save</button>
      </div>
    </div>
  </div>

  <script src="version/version.js"></script>
  <!-- load order matters: storage → utils → ui → modals → terminal → commands → main -->
  <script src="script/utils.js"></script>
  <script src="script/storage.js"></script>
  <script src="script/time-weather.js"></script>
  <script src="script/bookmarks.js"></script>
  <script src="script/modals/config.js"></script>
  <script src="script/modals/bookmarks.js"></script>
  <script src="script/modals/help.js"></script>
  <script src="script/modals/ipinfo.js"></script>
  <script src="script/modals/speedtest.js"></script>
  <script src="script/modals/spell.js"></script>
  <script src="script/modals/gemini.js"></script>
  <script src="script/modals/customize.js"></script>
  <script src="script/commands.js"></script>
  <script src="script/terminal.js"></script>
  <script src="script/script.js"></script>
</body>

</html>